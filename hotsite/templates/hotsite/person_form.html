{% extends 'hotsite/base.html' %}
{% load l10n humanize static form_config_tags user_agents user_agent_tag %}

{% block content %}

    {% include 'hotsite/includes/2_cover_no_form.html' %}

    <!-- FORM
    ================================= -->
    <section id="about" class="about-section section">
        <div class="container">
            <h2 class="section-heading text-center">Inscrição</h2>
            <div class="about-row row">
                <div class="col-md-9 col-md-offset-2">


                    <form method="post" action="">

                        {% csrf_token %}

                        {% if form.non_field_errors %}
                            {% render_errors form.non_field_errors %}
                        {% endif %}

                        {% for hidden_field in form.hidden_fields %}
                            {% if hidden_field.errors %}
                                {% render_errors hidden_field.errors %}
                            {% endif %}
                            {{ hidden_field }}
                        {% endfor %}


                        {% block messages %}
                            {% if messages %}
                                <div style="width:100%;margin-top:3px;padding-bottom:10px">
                                {% for message in messages %}

                                    {% if message.tags %}
                                        <div class="alert alert-{{ message.tags }} alert-dismissible"
                                             role="alert">

                                    {% else %}
                                        <div class="alert alert-warning alert-dismissible"
                                             role="alert">
                                    {% endif %}

                                <button type="button" class="close"
                                        data-dismiss="alert"
                                        aria-label="Close"><span
                                        aria-hidden="true">&times;</span>
                                </button>
                                {{ message|capfirst }}
                                </div>

                                {% endfor %}
                            </div>
                            {% endif %}
                        {% endblock messages %}

                        <div class="form-validation alert"></div>

                        <div style="margin-bottom: 20px">

                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <div class="panel-title">
                                        Dados pessoais
                                    </div>
                                </div>
                                <div class="panel-body">

                                    <div class="row">
                                        <div class="col-md-9">
                                            {% render_generic_field form.name autofocus=True %}

                                        </div>
                                        <div class="col-md-3">
                                            {% render_generic_field form.gender required=True %}
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-9">
                                            {% if config %}
                                                {% render_generic_field form.email config.email False %}
                                            {% else %}
                                                {% render_generic_field form.email %}
                                            {% endif %}
                                        </div>
                                        <div class="col-md-3">
                                            {% if config and config.cpf != config.CPF_HIDE %}
                                                {% if config.cpf == config.CPF_REQUIRED %}
                                                    {% render_generic_field form.cpf required=True %}
                                                {% else %}
                                                    {% render_generic_field form.cpf %}
                                                {% endif %}
                                            {% endif %}
                                        </div>
                                    </div>

                                    <div class="row">

                                        {% if config and config.birth_date != config.BIRTH_DATE_HIDE %}

                                            <div class="col-md-6">
                                                {% if config.birth_date == config.BIRTH_DATE_REQUIRED %}
                                                    {% render_generic_field form.birth_date required=True %}
                                                {% else %}
                                                    {% render_generic_field form.birth_date %}
                                                {% endif %}


                                            </div>
                                        {% endif %}
                                        <div class="col-md-6">
                                            {% if config %}
                                                {% render_generic_field form.phone config.phone False %}
                                            {% else %}
                                                {% render_generic_field form.phone %}
                                            {% endif %}
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-12">
                                            {% if config and config.address == config.ADDRESS_HIDE %}
                                                <div class="row">
                                                    <div class="col-md-3 address-row">
                                                        {% render_generic_field form.state required=config.city %}
                                                    </div>
                                                    <div class="col-md-9 address-row">
                                                        {% render_generic_field form.city_name required=config.city %}
                                                    </div>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>

                                    <div class="row">
                                        {% if config and config.institution_show is True %}
                                            <div class="col-md-4">
                                                {% render_generic_field form.institution required=config.institution_required %}
                                            </div>
                                        {% endif %}
                                        {% if config and config.institution_cnpj_show is True %}
                                            <div class="col-md-4">
                                                {% render_generic_field form.institution_cnpj required=config.institution_cnpj_required %}
                                            </div>
                                        {% endif %}
                                        {% if config and config.function_show is True %}
                                            <div class="col-md-4">
                                                {% render_generic_field form.function required=config.function_required %}
                                            </div>
                                        {% endif %}
                                    </div>

                                </div>
                            </div>

                            {% if config and config.address == config.ADDRESS_SHOW %}
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <div class="panel-title">
                                            Endereço
                                        </div>
                                    </div>

                                    <div class="panel-body">
                                        <div class="row">
                                            <div class="col-md-3">
                                                {% render_generic_field form.zip_code required=True %}
                                                <div id="cep_loader"
                                                     style="width: 22px;position: absolute;top: 40px;right: 24px;">
                                                    <img src="{% static 'assets/img/loader.gif' %}"/>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row address-row">
                                            <div class="col-md-9">
                                                {% render_generic_field form.street %}
                                            </div>
                                            <div class="col-md-3 address-row">
                                                {% render_generic_field form.number %}
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 address-row">
                                                {% render_generic_field form.complement %}
                                            </div>
                                            <div class="col-md-6 address-row">
                                                {% render_generic_field form.village %}
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-3 address-row">
                                                {% render_generic_field form.state required=True %}
                                            </div>
                                            <div class="col-md-9 address-row">
                                                {% render_generic_field form.city_name required=True %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}

                            <button style="margin-top: 5px;"
                                    class="btn
                                                        btn-primary pull-right"
                                    type="submit">
                                Próximo
                            </button>

                            <a
                                    {% if has_lots %}
                                        href="{% url 'public:hotsite-subscription' event.slug %}"
                                    {% else %}
                                        href="{% url 'public:hotsite' event.slug %}"
                                    {% endif %}

                                class="btn btn-primary pull-left"
                                style="margin-top: 5px;">
                            Voltar
                            </a>

                        </div>

                    </form>


                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block scripts %}

    <!-- SCRIPT Subscription -->
    <script src="{% static "hotsite/js/subscription.js" %}"></script>
    <script>
        $(document).ready(function () {


            var id_city = $('#id_city');


            window.setTimeout(function () {


                {% if config and config.address == config.ADDRESS_SHOW %}
                    $('#id_zip_code').mask("99999-999");
                {% endif %}

                if (id_city.val()) {

                    $.ajax({
                        url: "/api/cities/" + id_city.val(),
                        success: function (result) {
                            $('#id_city_search').val(result.name + ' - ' +
                                result.uf) //populate the html with result here

                        }
                    });

                }
                showHideCepLoader();

                let radios = $('input[type=radio]');

                radios.iCheck({
                    checkboxClass: 'icheckbox_flat-grey',
                    radioClass: 'iradio_flat-grey'
                });


            }, 300);
        });


    </script>




{% endblock %}



