{% extends "base/base.html" %}
{% load i18n static url_tags  form_config_tags %}

{% block title %}Processar importação | Congressy{% endblock %}

{% block page_title %}Processar importação via CSV{% endblock %}
{% block page_sub_title %}{{ event.name }} | object.filename{% endblock %}
{% block page_description %}
    Processar importação de dados via CSV
{% endblock %}

{% block content %}

    <div class="row">
        <div class="col-md-12">
            <div class="buttonbar">
                <div class="float-left">
                    <a href="{% url 'subscription:subscriptions-csv-list' event.pk %}"
                       class="btn btn-primary">
                        <i class="fas fa-arrow-circle-left"></i>
                        Voltar
                    </a>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>


    {% if preview and denied_reason is None %}
        <div class="row" id="preview">
            <div class="col-md-12">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h3 class="panel-title">Preview</h3>
                    </div>
                    <div class="panel-body">

                        <div class="row">
                            <div class="col-md-12" id="preview-content" style="margin-top: 15px">

                                nada.

                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    {% elif denied_reason %}
        <div class="row" id="preview_error">
            <div class="col-md-12">
                <div class="panel panel-warning">
                    <div class="panel-heading">
                        <h3 class="panel-title">Preview</h3>
                    </div>
                    <div class="panel-body">

                        <div class="row">
                            <div class="col-md-12 text-center" id="preview-content" style="margin-top: 15px">

                                <h1>
                                    <strong>
                                        <i class="fas fa-exclamation-triangle warning-color"></i>
                                        Atenção!
                                        <i class="fas fa-exclamation-triangle warning-color"></i>
                                    </strong>
                                </h1>

                                <h2 style="margin-top: 5px">
                                    {{ denied_reason }}
                                </h2>

                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    {% else %}
        <div class="row" id="unknown_preview_error">
            <div class="col-md-12">
                <div class="panel panel-warning">
                    <div class="panel-heading">
                        <h3 class="panel-title">Preview</h3>
                    </div>
                    <div class="panel-body">

                        <div class="row">
                            <div class="col-md-12 text-center" id="preview-content" style="margin-top: 15px">

                                <h1>
                                    <strong>
                                        <i class="fas fa-exclamation-triangle warning-color"></i>
                                        Atenção!
                                        <i class="fas fa-exclamation-triangle warning-color"></i>
                                    </strong>
                                </h1>

                                <h2 style="margin-top: 5px">
                                    Ocorreu algum erro desconhecido. Por favor entre em contato com a equipe Congressy para maiores informações.
                                </h2>

                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    {% if preview %}

        <div class="row" id="keys">

            <div class="col-md-6">

                <div class="panel panel-primary">

                    <div class="panel-heading">
                        <h3 class="panel-title">
                            Campos Obrigatórios
                        </h3>
                    </div>
                    <div class="panel-body">

                        <div class="row">

                            <div class="col-md-12">
                                <div class="alert alert-warning alert-dismissable">
                                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                                    <strong>Atenção!</strong>
                                    Todos os campos abaixo são necessarios para a criação de uma inscrição no lote selecionado.
                                </div>

                                <table class="table">
                                    <thead>
                                    <tr>
                                        <th>Nome da coluna</th>
                                        <th>Descrição</th>
                                    </tr>
                                    </thead>
                                    <tbody>

                                    {% for entry in required_keys %}

                                        <tr>
                                            <td>
                                                <strong>

                                                    {% with entry.csv_keys|first as first_key %}
                                                        {{ first_key }}
                                                    {% endwith %}

                                                </strong>
                                            </td>
                                            <td>
                                                {{ entry.description|capfirst }}
                                            </td>
                                        </tr>

                                    {% endfor %}


                                    </tbody>
                                </table>

                            </div>

                        </div>

                    </div>
                </div>
            </div>

            {% if preview.invalid_keys|length > 0 %}

                <div class="col-md-6">
                    <div id="invalid-keys" class="panel panel-danger">
                        <div class="panel-heading">
                            <h3 class="panel-title">
                                Campos que serão ignorados
                            </h3>
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <h3>
                                    <ul>
                                        {% for key in  preview.invalid_keys %}
                                            <li>{{ key|truncatechars:40 }}</li>
                                        {% endfor %}
                                    </ul>
                                </h3>
                            </div>
                        </div>
                    </div>


                </div>

            {% endif %}


        </div>

    {% endif %}

{% endblock %}
