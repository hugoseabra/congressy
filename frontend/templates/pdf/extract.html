{% load i18n static base_tags queryset_filter payment_report l10n humanize %}
{% now "Y-m-d" as today %}
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <title>Extrato</title>
    <link rel="stylesheet"
          href="{{ base_url }}assets/plugins/bootstrap/css/bootstrap.min.css">

    <style>
        .table.no-border tr td, .table.no-border tr th {
            border-width: 0;
            border: none;
        }

        thead {
            display: table-header-group
        }

        tfoot {
            display: table-row-group
        }

        tr {
            page-break-inside: avoid
        }

        th, td, small {
            font-size: .65em;
        }

        table.cancelled-contract-table span {
            text-decoration: line-through;
            color: #DDD;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="row">
        <div class="col-md-4">
            <img src="data:image/png;base64,{{ logo }}"
                 style="margin-top: 15px;" alt="Congressy">
        </div>
    </div>
    <div class="row" align="center">
        <h3 style="font-weight: bold;">
            {{ event.name|upper|truncatechars:80 }}
        </h3>
    </div>
    <div class="row" align="center">
        <h4 style="font-weight: bold">EXTRATO DE INSCRIÇÃO</h4>
        <small class="text-muted">Gerado ás {{ now|date:"d/m/Y H\hi" }} por {{ by }}</small>
    </div>
    <hr class="hr"/>

    <div style="margin-top: 20px">

        <h5 style="font-weight: bold;">Pessoais</h5>

        <table class="table no-border" style="border-width: 0;margin-top: 20px">
            <tbody style="border-width: 0;">

            <tr style="border-width: 0;">
                <td width="20%" style="border-width: 0;">
                    <strong>Nome completo:</strong>
                </td>
                <td class="col-sm-2">
                    {{ person.name|title }}
                </td>
            </tr>

            <tr>
                <td class="col-sm-2" style="border-width: 0;">
                    <strong>
                        Email:
                    </strong>
                </td>
                <td>
                    {{ person.email|lower }}
                </td>
            </tr>

            </tbody>

        </table>

    </div>

    <div>

        <h5 style="font-weight: bold;">Inscrição</h5>

        <table class="table no-border" style="width:100%;border-width: 0;margin-top: 20px">
            <tbody style="border-width: 0;">

            <tr style="border-width: 0;">
                <td width="12%" style="border-width: 0;">
                    <strong>
                        Lote:
                    </strong>
                </td>
                <td>
                    {{ lot.name }}
                </td>
            </tr>
            <tr style="border-width: 0;">
                <td width="12%" style="border-width: 0;">
                    <strong>
                        Código:
                    </strong>
                </td>
                <td>
                    {{ object.code }}
                </td>
            </tr>
            <tr style="border-width: 0;">
                <td width="12%" style="border-width: 0;">
                    <strong>
                        Número:
                    </strong>
                </td>
                <td>
                    {{ object.event_count }}
                </td>
            </tr>
            <tr style="border-width: 0;">
                <td width="12%" style="border-width: 0;">
                    <strong>
                        Status:
                    </strong>
                </td>
                <td>
                    {{ object.get_status_display }}
                </td>
            </tr>

            </tbody>

        </table>

    </div>

    {% if lot.price and lot.price > 0 %}
        <div>
            <h5 style="font-weight: bold;">Financeiro</h5>

            {% now "Y-m-d" as today %}
            {% for lot in financial_report.lots %}
                <h5 class="text-bold">{{ lot.name }}</h5>
                <hr/>
                {% filter_lookup financial_report.debt_amounts lot.pk as debt_items %}
                {% filter_lookup financial_report.paid_amounts lot.pk as payment_items %}
                {% filter_lookup financial_report.tax_amounts lot.pk as tax_items %}

                <table class="table table-hover table-striped table-bordered transaction-list">
                    <thead>
                    <tr>
                        <th width="18%">Data/hora</th>
                        <th>Descrição</th>
                        <th class="text-center" width="2%">
                            <span class="text-prmary">Tipo</span>
                        </th>
                        <th class="text-center" width="15%">Valor (R$)</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for item in debt_items %}
                    <tr>
                        <td class="table-row text-center">
                            <span>{{ item.created_on|date:"d/m/Y H\hi" }}</span>
                        </td>
                        <td class="table-row">
                            <div>
                                <div class="float-left hidden-sm hidden-xs">
                                    <i style="font-size:30px" class="fas fa-user-edit"></i>
                                </div>
                                <div class="float-left" style="margin-left:5px">
                                    <div class="text-bold">{{ item.name }}</div>
                                    <small class="text-muted text-bold">{{ item.description|safe }}</small>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </td>
                        <td class="table-row text-center text-bold">
                            <span class="text-danger" data-toggle="tooltip" title="Débito">D</span>
                        </td>
                        <td class="table-row text-right">
                            <span class="text-danger">R$ {{ item.amount|intcomma }}</span>
                        </td>
                    </tr>
                    {% endfor %}

                    {% for item in payment_items %}
                        <tr>
                            <td class="table-row text-center">
                                <span>{{ item.created_on|date:"d/m/Y H\hi" }}</span>
                            </td>
                            <td class="table-row">
                                <div>
                                    <div>
                                        {% if item.manual is True %}
                                            {% if item.manual_type == item.transaction.MANUAL_PAYMENT_MONEY %}
                                                <div class="float-left hidden-sm hidden-xs">
                                                    <i style="font-size:30px" class="far fa-money-bill-alt"></i>
                                                </div>
                                                <div class="float-left" style="margin:5px 0 0 5px">
                                                    <span class="text-bold">Dinheiro</span>
                                                    <small>(manual)</small>
                                                </div>
                                                {% if event.feature_configuration.feature_manual_payments %}
                                                    <div class="float-right" style="margin-top:5px">
                                                        <a style="margin-left:10px;" href="javascript:void(0)" onclick="delete_payment('{{ item.transaction.pk }}', '{{ item.amount|intcomma }}')">
                                                            <i class="fas fa-trash-alt text-danger" data-toggle="tooltip" title="Excluir"></i>
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            {% elif item.manual_type == item.transaction.MANUAL_PAYMENT_PAYCHECK %}
                                                <div class="float-left hidden-sm hidden-xs">
                                                    <i style="font-size:30px" class="fas fa-money-check-alt"></i>
                                                </div>
                                                <div class="float-left" style="margin:5px 0 0 5px">
                                                    <span class="text-bold">Cheque</span>
                                                    <small>(manual)</small>
                                                </div>
                                                {% if event.feature_configuration.feature_manual_payments %}
                                                    <div class="float-right" style="margin-top:5px">
                                                        <a style="margin-left:10px;" href="javascript:void(0)" onclick="delete_payment('{{ item.transaction_pk }}', '{{ item.transaction.amount|intcomma }}')">
                                                            <i class="fas fa-trash-alt text-danger" data-toggle="tooltip" title="Excluir"></i>
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            {% elif item.manual_type == item.transaction.MANUAL_PAYMENT_DEBIT_CARD %}
                                                <div class="float-left hidden-sm hidden-xs">
                                                    <i style="font-size:30px" class="far fa-credit-card"></i>
                                                </div>
                                                <div class="float-left" style="margin:5px 0 0 5px">
                                                    <span class="text-bold">Cartão de Débito</span>
                                                    <small>(manual)</small>
                                                </div>
                                                {% if event.feature_configuration.feature_manual_payments %}
                                                    <div class="float-right" style="margin-top:5px">
                                                        <a style="margin-left:10px;" href="javascript:void(0)" onclick="delete_payment('{{ item.transaction.pk }}', '{{ item.transaction.amount|intcomma }}')">
                                                            <i class="fas fa-trash-alt text-danger" data-toggle="tooltip" title="Excluir"></i>
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            {% elif item.manual_type == item.transaction.MANUAL_PAYMENT_CREDIT_CARD %}
                                                <div class="float-left hidden-sm hidden-xs">
                                                    <i style="font-size:30px" class="far fa-credit-card"></i>
                                                </div>
                                                <div class="float-left" style="margin:5px 0 0 5px">
                                                    <span class="text-bold">Cartão de Crédito</span>
                                                    <small>(manual)</small>
                                                </div>
                                                {% if event.feature_configuration.feature_manual_payments %}
                                                    <div class="float-right" style="margin-top:5px">
                                                        <a style="margin-left:10px;" href="javascript:void(0)" onclick="delete_payment('{{ item.transaction.pk }}', '{{ item.transaction.amount|intcomma }}')">
                                                            <i class="fas fa-trash-alt text-danger" data-toggle="tooltip" title="Excluir"></i>
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            {% elif item.manual_type == item.transaction.MANUAL_PAYMENT_BANK_DEPOSIT %}
                                                <div class="float-left hidden-sm hidden-xs">
                                                    <i style="font-size:30px" class="fas fa-university"></i>
                                                </div>
                                                <div class="float-left" style="margin:5px 0 0 5px">
                                                    <span class="text-bold">Depósito</span>
                                                    <small>(manual)</small>
                                                </div>
                                                {% if event.feature_configuration.feature_manual_payments %}
                                                    <div class="float-right" style="margin-top:5px">
                                                        <a style="margin-left:10px;" href="javascript:void(0)" onclick="delete_payment('{{ item.transaction.pk }}', '{{ item.transaction.amount|intcomma }}')">
                                                            <i class="fas fa-trash-alt text-danger" data-toggle="tooltip" title="Excluir"></i>
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            {% elif item.manual_type == item.transaction.MANUAL_PAYMENT_BANK_TRANSFER %}
                                                <div class="float-left hidden-sm hidden-xs">
                                                    <i style="font-size:30px" class="fas fa-exchange-alt"></i>
                                                </div>
                                                <div class="float-left" style="margin:5px 0 0 5px">
                                                    <span class="text-bold">Transferência bancária</span>
                                                    <small>(manual)</small>
                                                </div>
                                                {% if event.feature_configuration.feature_manual_payments %}
                                                    <div class="float-right" style="margin-top:5px">
                                                        <a style="margin-left:10px;" href="javascript:void(0)" onclick="delete_payment('{{ item.transaction.pk }}', '{{ item.transaction.amount|intcomma }}')">
                                                            <i class="fas fa-trash-alt text-danger" data-toggle="tooltip" title="Excluir"></i>
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            {% elif item.manual_type == item.transaction.MANUAL_WAITING_PAYMENT %}
                                                <div class="float-left hidden-sm hidden-xs">
                                                    <i style="font-size:30px" class="fas fa-warning"></i>
                                                </div>
                                                <div class="float-left" style="margin:5px 0 0 5px">
                                                    <span class="text-bold">Pendente para pagamento</span>
                                                    <small>(manual)</small>
                                                </div>
                                                {% if event.feature_configuration.feature_manual_payments %}
                                                    <div class="float-right" style="margin-top:5px">
                                                        <a style="margin-left:10px;" href="javascript:void(0)" onclick="delete_payment('{{ item.transaction.pk }}', '{{ item.transaction.amount|intcomma }}')">
                                                            <i class="fas fa-trash-alt text-danger" data-toggle="tooltip" title="Excluir"></i>
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            {% endif %}
                                            <div class="clearfix"></div>
                                            {% if item.transaction.part_id %}
                                            <div>
                                                <div>
                                                    <small>
                                                        Parcela relacionada:
                                                        <strong>{{ item.transaction.part.installment_number }}x</strong> -
                                                    </small>
                                                    <small><strong>CONTRATO ID:</strong> {{ item.transaction.part.contract_id }}</small>
                                                    {% if item.transaction.part.contract.status == 'cancelled' %}
                                                        <span class="text-danger"> CANCELADO</span>
                                                    {% endif %}
                                                </div>
                                                <small class="text-muted">
                                                    <strong>Criado:</strong> {{ item.transaction.part.contract.created|date:"d/m/Y H\hi" }}
                                                </small>
                                            </div>
                                            {% endif %}
                                        {% else %}
                                            {% if item.transaction.type == item.transaction.BOLETO %}
                                                <div class="float-left hidden-sm hidden-xs">
                                                    <i style="font-size:30px" class="fas fa-barcode"></i>
                                                </div>
                                                <div class="float-left" style="margin:5px 0 0 5px">
                                                    <span class="text-bold">Boleto</span>
                                                    <small>(on-line)</small>
                                                </div>
                                            {% elif item.transaction.type == item.transaction.CREDIT_CARD %}
                                                <div class="float-left hidden-sm hidden-xs">
                                                    <i style="font-size:30px" class="far fa-credit-card"></i>
                                                </div>
                                                <div class="float-left" style="margin-left: 5px">
                                                    <div>
                                                        <span class="text-bold">Cartão de Crédito</span>
                                                        <small>(on-line)</small>
                                                    </div>
                                                    <div>
                                                        {% if item.transaction.credit_card_last_digits %}
                                                            <small class="text-muted text-bold">
                                                                *** *** {{ item.transaction.credit_card_last_digits }}
                                                            </small>
                                                        {% endif %}
                                                        {% if item.transaction.credit_card_holder %}
                                                            <small class="text-muted text-bold">
                                                                ({{ item.transaction.credit_card_holder|upper }})
                                                            </small>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            {% endif %}
                                        {% endif %}
                                        <div class="clearfix"></div>
                                    </div>
                                    {% if item.manual is False and item.transaction.type == item.transaction.BOLETO %}
                                        <div>
                                            <small class="text-bold">Vencimento:</small>
                                            <small>{{ item.transaction.boleto_expiration_date }}</small>
                                        </div>
                                    {% endif %}
                                </div>
                            </td>
                            <td class="table-row text-center text-bold">
                                {% if item.manual is False %}
                                    {% if transaction.type == item.transaction.CREDIT_CARD %}
                                        <div>
                                            <span class="text-success" data-toggle="tooltip" title="Entrada">C</span>
                                        </div>
                                    {% else %}
                                        <div>
                                            <span class="text-success" data-toggle="tooltip" title="Entrada">C</span>
                                        </div>
                                    {% endif %}

                                {% else %}
                                    <div>
                                        <span class="text-success" data-toggle="tooltip" title="Entrada">C</span>
                                    </div>
                                {% endif %}
                            </td>
                            <td class="table-row text-right">
                                {% if item.manual is False %}
                                    {% if transaction.type == transaction.CREDIT_CARD %}
                                        <div>
                                            <span class="text-success">R$ {{ item.amount|intcomma }}</span>
                                        </div>
                                    {% else %}
                                        <div>
                                            <span class="text-success">R$ {{ item.amount|intcomma }}</span>
                                        </div>
                                    {% endif %}
                                {% else %}
                                <div>
                                    <span class="text-success">R$ {{ item.amount|intcomma }}</span>
                                </div>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                    {% for item in tax_items %}
                    <tr>
                        <td class="table-row text-center">
                            <span>{{ item.created_on|date:"d/m/Y H\hi" }}</span>
                        </td>
                        <td class="table-row">
                            <div>
                                <div class="float-left hidden-sm hidden-xs">
                                    <i style="font-size:30px" class="fas fa-user-edit"></i>
                                </div>
                                <div class="float-left" style="margin-left:5px">
                                    <div class="text-bold">{{ item.name }}</div>
                                    <small class="text-muted text-bold">{{ item.description|safe }}</small>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </td>
                        <td class="table-row text-center text-bold">
                            <span class="text-danger" data-toggle="tooltip" title="Débito">D</span>
                        </td>
                        <td class="table-row text-right">
                            <span class="text-danger">R$ {{ item.amount|intcomma }}</span>
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="3" class="table-row text-right text-bold">TOTAL</td>
                        <td class="text-right text-bold">
                            {% if financial_report.cash_amount < 0 %}
                                <span class="text-bold text-danger">R$ {{ financial_report.cash_amount|intcomma }}</span>
                            {% elif financial_report.cash_amount > 0 %}
                                <span class="text-bold text-success">R$ {{ financial_report.cash_amount|intcomma }}</span>
                            {% elif financial_report.cash_amount == 0 %}
                                <span class="text-bold">R$ {{ financial_report.cash_amount|intcomma }}</span>
                            {% endif %}
                        </td>
                    </tr>
                    </tfoot>
                </table>
            {% endfor %}

        </div>

        {% if contracts.count > 0 %}

            <hr class="hr" />
            <div>
                <div class="text-center">
                    <h4 style="font-weight: bold;margin:0 auto">Contratos de Parcelamento</h4>
                </div>
                {% for contract in contracts %}
                    <br />
                    <div style="font-size:12px">
                        <strong>Contrato (ID: {{ contract.pk }})</strong>:
                        {{ contract.created|date:"d/m/Y H\hi" }}
                        {% if contract.status == 'cancelled' %}
                            <strong class="text-danger"> CANCELADO</strong>
                        {% endif %}
                    </div>
                    <table class="table borderless {% if contract.status == 'cancelled' %}cancelled-contract-table{% endif %}" style="width:100%">
                        <thead>
                        <tr>
                            <th width="5%">Parcela</th>
                            <th width="12%">Vencimento</th>
                            <th class="text-center" width="15%">Valor (R$)</th>
                            <th class="text-center" width="10%">Status</th>
                        </tr>
                        </thead>

                        <tbody>

                        {% for part in contract.parts.all %}
                            <tr>
                                <td class="table-row text-center">
                                    <span class="value">{{ part.installment_number }}</span>
                                </td>
                                <td class="table-row text-center">
                                    <span class="value">{{ part.expiration_date|date:"d/m/Y" }}</span>
                                </td>
                                <td class="table-row text-right">
                                    <span class="{% if part.paid %}text-success{% else %}text-danger{% endif %} value">
                                        R$ {{ part.amount|intcomma }}
                                    </span>
                                </td>
                                <td class="table-row text-center">
                                    {% if part.paid %}
                                    <span class="value text-success">pago</span>
                                    {% else %}
                                    <span class="value text-danger">aguardando</span>
                                    {% endif %}
                                </td>
                            </tr>

                        {% endfor %}
                        </tbody>
                    </table>

                    <hr/>
                {% endfor %}

            </div>

        {% endif %}


    {% endif %}

</div>

</body>
</html>


