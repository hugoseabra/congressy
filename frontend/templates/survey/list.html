{% extends "base/base.html" %}
{% load static base_tags queryset_filter form_config_tags %}


{% block nav_aside_itens %}
    <h5 class="sidebar-header">Participantes</h5>
    <ul class="nav nav-pills nav-stacked">
        {% if event.subscription_type != event.SUBSCRIPTION_SIMPLE %}
            <li>
                <a href="{% url 'subscription:lot-list' event.pk %}"
                   title="Inscrições">
                    <i class="fa  fa-fw fa-rocket"></i>
                    Lotes/Categorias
                </a>
            </li>
        {% endif %}
        <li>
            <a href="{% url 'subscription:subscription-list' event.pk %}"
               title="Inscrições">
                <i class="fa  fa-fw fa-rocket"></i>
                Inscrições
                <span class="badge float-right">{{ event.subscriptions|queryset_count:"status__in=['confirmed','awaiting']" }}</span>
            </a>
        </li>
        {#        <li>#}
        {#            <a href="{% url 'subscription:subscription-attendance-search' event.pk %}"#}
        {#               title="Check-in">#}
        {#                <i class="fa  fa-fw fa-rocket"></i>#}
        {#                Check-in#}
        {#            </a>#}
        {#        </li>#}
    </ul>
    <h5 class="sidebar-header">Configurações</h5>
    <ul class="nav nav-pills nav-stacked">
        <li>
            <a href="{% url 'event:event-hotsite' event.pk %}"
               title="Página do evento">
                <i class="fa  fa-fw fa-rocket"></i> Página do evento
            </a>
        </li>
        <li class="active">
            <a href="{% url 'subscription:form-config' event.pk %}"
               title="Formulário">
                <i class="fa  fa-fw fa-rocket"></i> Formulário
            </a>
        </li>
        {% if has_paid_lots %}
            <li>
                <a href="{% url 'payment:event-payments' event.pk %}"
                   title="Pagamentos">
                    <i class="fa  fa-fw fa-rocket"></i> Pagamentos
                </a>
            </li>
        {% endif %}
    </ul>
{% endblock %}

{% block messages %}
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissable">
                <button type="button" class="close"
                        data-dismiss="alert" aria-hidden="true">×
                </button>
                {{ message|get_first_item }}
            </div>
        {% endfor %}
    {% endif %}
{% endblock messages %}

{% block title %}
    Formulário de Inscrição | Congressy
{% endblock %}

{% block page_title %}
    Formulário Personalizados
{% endblock %}

{% block page_sub_title %}
    <div>{{ event.name }}</div>
{% endblock %}

{% block content %}

    <div class="col-12">

        <div class="tab-wrapper tab-primary">
            <ul class="nav nav-tabs">
                <li>
                    <a href="{% url 'subscription:form-config' event.pk %}">
                        Formulário Padrão
                    </a>
                </li>
                <li class="active">
                    <a href="{% url 'subscription:survey-list' event.pk %}">
                        Formulário Personalizado
                    </a>
                </li>
            </ul>
            <div class="tab-content">

                <div class="row">
                    <div class="col-md-12">
                        <div class="buttonbar">
                            <div class="float-right">
                                <button type="button" class="btn btn-success"
                                        data-toggle="modal"
                                        data-target="#addSurvey">
                                    <i class="fa fa-plus"></i>
                                    Adicionar
                                </button>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-primary">
                            <div class="panel-body">
                                {% if object_list %}
                                    <table class="table">
                                        <thead>
                                        <tr>
                                            <th style="width: 30%">Nome</th>
                                            <th></th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for event_survey in object_list %}
                                            <tr>
                                                <td>
                                                    {{ event_survey.survey.name }}

                                                </td>
                                                <td>
                                                    <a class="
                                                    btn
                                                    btn-primary"
                                                       href="
{% url 'subscription:survey-edit' event.pk event_survey.pk %}">
                                                        <i class="fas fa-pencil-alt"></i>
                                                        Gerenciar campos
                                                    </a>
                                                    <br/>
                                                    <button type="button"
                                                            class="btn
                                                            btn-danger
                                                            open-DeleteQuestionDialog"
                                                            data-event="{{ event.pk }}"
                                                            data-survey="{{ event_survey.pk }}">
                                                        <i class="fas fa-trash-alt"></i>
                                                        Deletar
                                                    </button>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>

                                {% else %}
                                    <h3>Nenhum formulário.</h3>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>


    <div class="modal fade" id="addSurvey"
         role="dialog">

        <div class="modal-dialog " role="document">

            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close"
                            data-dismiss="modal"
                            aria-label="Close"><span
                            aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title">
                        Novo formulário</h4>
                </div>

                <form method="post">

                    {% csrf_token %}


                    <div class="modal-body">
                        {% render_generic_field form.name autofocus=True %}
                        {% render_generic_field form.description %}
                    </div>


                    <div class="modal-footer">
                        <button type="button"
                                class="btn btn-danger"
                                data-dismiss="modal">Cancelar
                        </button>
                        <button type="submit"
                                class="btn btn-success">Salvar
                        </button>
                    </div>


                </form>

            </div>

        </div>

    </div>
    <div class="modal fade" id="editSurvey"
         role="dialog">

        <div class="modal-dialog " role="document">

            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close"
                            data-dismiss="modal"
                            aria-label="Close"><span
                            aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title">
                        Editar questionário</h4>
                </div>

                <form method="post">

                    {% csrf_token %}


                    <div class="modal-body">

                        <div class="form-group">

                            <label>Nome:</label>

                            <small style="color:#C9302C">*</small>


                            <div>

                                <input type="text" maxlength="255"
                                       autofocus="" required=""
                                       class="form-control form-control"
                                       id="surveyEditTitle">


                                <div>
                                    <small class="text-muted">Nome do seu
                                        questionário
                                    </small>
                                </div>


                            </div>
                        </div>

                        <div class="form-group">

                            <label>Descrição:</label>


                            <div>


                                <textarea cols="20" rows="3"
                                          class="form-control"
                                          id="surveyEditDescription"></textarea>


                                <div>
                                    <small class="text-muted">Uma descrição para
                                        te ajudar a identificar este
                                        questionário.
                                    </small>
                                </div>


                            </div>
                        </div>

                        <input type="hidden" name="action">

                    </div>


                    <div class="modal-footer">
                        <button type="button"
                                class="btn btn-danger"
                                data-dismiss="modal">Cancelar
                        </button>
                        <button type="submit"
                                class="btn btn-success new_survey_save ">Salvar
                        </button>
                    </div>


                </form>

            </div>

        </div>

    </div>
    <div class="modal fade" id="deleteSurvey"
         role="dialog">

        <div class="modal-dialog " role="document">

            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close"
                            data-dismiss="modal"
                            aria-label="Close"><span
                            aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title">
                        Apagar questionário</h4>
                </div>

                <div id="question_delete_modal"></div>

            </div>

        </div>

    </div>


{% endblock %}

{% block scripts %}

    <script type="application/javascript">

        $(document).ready(function () {

            $(".open-editSurvey").click(function () {
                console.log($(this).data('title'));
                $('#surveyEditId').val($(this).data('id'));
                $('#surveyEditTitle').val($(this).data('title'));
                $('#surveyEditDescription').val($(this).data('description'));
                $('input.action').val('edit');
                $('#editSurvey').modal('show');
            });


            $(".open-deleteSurvey").click(function () {
                $('#surveyDeleteId').val($(this).data('id'));
                $('#surveyDeleteTitle').val($(this).data('title'));
                $('#surveyDeleteDescription').val($(this).data('description'));
                $('input.action').val('delete');
                $('#deleteSurvey').modal('show');
            });

            $(document).on("click", ".open-AddSimpleQuestionDialog", function () {
                var typeOfField = $(this).data('field-type');
                var IconOfField = $(this).data('field-icon');
                var typeEl = $('.modal-body .typeOfField');
                var iconEl = $('.modal-body .iconOfField');
                var formTypeEl = $('#id_simple_form-type');

                typeEl.text(typeOfField);
                iconEl.attr('class', 'iconOfField');
                iconEl.addClass(IconOfField);
                formTypeEl.val('simple');
                $('#options').hide();
                $('#addQuestion').modal('show');
            });

            $(document).on("click", ".open-AddComplexQuestionDialog", function () {

                var typeOfField = $(this).data('field-type');
                var IconOfField = $(this).data('field-icon');
                var typeEl = $('.modal-body .typeOfField');
                var iconEl = $('.modal-body .iconOfField');
                var formTypeEl = $('#id_complex_form-type');

                typeEl.text(typeOfField);
                iconEl.attr('class', 'iconOfField');
                iconEl.addClass(IconOfField);
                formTypeEl.val('complex');
                $('#options').show();
                $('#addQuestion').modal('show');
            });

            $(document).on("click", ".open-DeleteQuestionDialog", function () {

                var survey_id = $(this).data('survey');
                var event_id = $(this).data('event');

                $.get("/manage/events/" + event_id + "/survey/" + survey_id +
                    "/delete",
                    function
                        (data, status) {
                        $('#question_delete_modal').html(data);
                    });

                $('#deleteSurvey').modal('show');
            });

            //Disable btn on first click
            $(document).on("click", ".new_survey_save", function () {
                this.disabled = true;
            });


        });

    </script>

{% endblock %}

{% block styles %}
    <style>

        .list-group-item .control-buttons {
            visibility: hidden;
        }

        .list-group-item:hover .control-buttons {
            visibility: visible;
        }

    </style>


{% endblock %}


